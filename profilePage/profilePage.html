<!doctype html>
<html lang="en">


<head>
    <title>RentShack</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Mobland - Mobile App Landing Page Template">
    <meta name="keywords" content="HTML5, bootstrap, mobile, app, landing, ios, android, responsive">

    <!-- Font -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500" rel="stylesheet">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
<!--     <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
 -->
    <!-- Themify Icons -->
    <link rel="stylesheet" href="css/themify-icons.css">
    <!-- Owl carousel -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <!-- Main css -->
    <link href="css/style.css" rel="stylesheet">
    <link href="../css/nav.css" rel="stylesheet">
	<link href="css/nprogress.css" rel="stylesheet" /> <!--FOR LOADING PROCESS BAR-->

	
	  <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script> <!--FOR LOADING PROCESS BAR-->
	  <script src="js/nprogress.js"></script> <!--FOR LOADING PROCESS BAR-->

    	
<script src="https://www.gstatic.com/firebasejs/4.9.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.9.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.9.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.9.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.9.0/firebase-messaging.js"></script>

      
<script src="https://www.gstatic.com/firebasejs/4.10.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBApfToTzoqqENAUZkaoe75ArPH6OEqbgM",
    authDomain: "rentshack-d2f8f.firebaseapp.com",
    databaseURL: "https://rentshack-d2f8f.firebaseio.com",
    projectId: "rentshack-d2f8f",
    storageBucket: "rentshack-d2f8f.appspot.com",
    messagingSenderId: "474356914191"
  };
  firebase.initializeApp(config);
</script>



    
    <script>
		console.log('hello world');
		function toggleSignIn() {
			firebase.auth().signOut();
			window.location.replace("../landingPage/landingPage.html");
			
		}
	function initApp() {
      // Listening for auth state changes.
      // [START authstatelistener]
      firebase.auth().onAuthStateChanged(function(user) {
	  	if (user) {
          // User is signed in.
         // var displayName = user.username;
			var displayName = user.displayName;
          var email = user.email;
          var emailVerified = user.emailVerified;
          var photoURL = user.photoURL;
          var isAnonymous = user.isAnonymous;
          var uid = user.uid;
          var providerData = user.providerData;
/*			console.log(displayName);
*/		  global_uid = sliceUID();
		if(global_uid.length > 0)
			uid = global_uid;
		  
			
			//alert('uid is : ' + uid + ' global_uid is: ' + global_uid);
			
			return firebase.database().ref('/users/' + uid).once('value').then(function(snapshot) {
  			var username = (snapshot.val() && snapshot.val().username) || 'Anonymous';
  			document.getElementById('username').innerHTML = username;
			document.getElementById('profilePic').src = (snapshot.val() && snapshot.val().profilePic);

		    });			
		  }
	  });
	}

	
	</script>
    </head>

<body data-spy="scroll" data-target="#navbar" data-offset="30">

    <!-- Nav Menu -->
  <div id="contact">   
    <div class="nav-menu fixed-top">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <nav class="navbar navbar-light bg-company navbar-expand-lg">
                        <a class="navbar-brand" href="../homePage/homePage.html"><img src="../images/logo1.png" class="img-fluid" alt="logo"></a>
                       <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>

                       <div class="topnav">
                          <input type="text" placeholder="Search...">
                        </div>

                        <div class="collapse navbar-collapse" id="navbar">
                            <ul class="navbar-nav ml-auto">
                               <li class="nav-item"> <a class="nav-link" href="../postPage/postPage.html">Post</a></li>
                                <li class="nav-item"> <a class="nav-link" href="../messagePage/messagePage.html">Message</a> </li>
                                <li class="nav-item"> <a class="nav-link"  href="../profilePage/profilePage.html">Account</a> </li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </div>


    <header class="bg-gradient" id="home">
    </header>

<br>
<br>
<br>

    <div class="container">
        <div class="section-title">
            <h3>Profile</h3>
        </div>
    </div>
<!-- ================ Profile Section ================= -->

   
    <div class="container">
    <div class="row profile">
        <div class="col-md-3">
            <div class="profile-sidebar">
                <!-- SIDEBAR USERPIC -->
                    <!-- <img class="profile-pic"/>
                    <div class="upload-button">Upload Image</div>
                    <input class="file-upload" type="file" accept="image/*"/> -->

                    <div class="profile-upload">
                        <img id="profilePic" src="https://tmff.net/wp-content/uploads/2015/04/light-grey-background-pattern-i1.jpg" class="profile-pic"/>
                        <div class="upload-button">Upload Image</div>
                        <input style="display: none" class="file-upload" id="file" type="file"/>
                    </div>
                    
                    
          
                <!-- END SIDEBAR USERPIC -->
                <!-- SIDEBAR USER TITLE -->
                <div class="profile-usertitle">
                    <div class="profile-usertitle-name">
                        <h4 id="username"></h4>
                    </div> 
                    <div class="profile-usertitle-job">
                        Developer
                    </div>
                </div> 
                <!-- END SIDEBAR USER TITLE -->
                <!-- SIDEBAR BUTTONS -->
                <div class="profile-userbuttons">
                  <!--  <button type="button" class="btn btn-success btn-sm">Follow</button>-->
                    <button type="button" onClick="toggleSignIn();" class="btn btn-danger btn-sm">Sign Out</button>
                </div>
            </div>
        </div>
        <div class="col-md-9">
            <div class="profile-content">
               <div class="container">
                <div class="section-title">
                    <h3 id="myItems">My Items</h3>
                </div>
                <div id="rentList">
                </div>              
              </div>
          </div>
        </div>
      </div>
    </div>
</div> 

    
    <!-- // end .section -->
    <footer class="my-5 text-center">
        <!-- Copyright removal is not prohibited! -->
        <p class="mb-2"><small></small></p>
        <small>
            <a href="#" class="m-2">PRESS</a>
            <a href="#" class="m-2">TERMS</a>
            <a href="#" class="m-2">PRIVACY</a>
        </small>
    </footer>  

    <!-- jQuery and Bootstrap -->
    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <!-- Plugins JS -->
    <script src="js/owl.carousel.min.js"></script>
    <!-- Custom JS -->
    <script src="js/script.js"></script>
    <script src="js/main.js"></script>

	
<!--	SCRIPT FOR LOADING BAR   -->
	  <script>
    $('body').show();
    $('.version').text(NProgress.version);
    NProgress.start();
    setTimeout(function() { NProgress.done(); $('.fade').removeClass('out'); }, 300); <!-- CHANGE NUMBER TO ADJUST SPEED -->

    $("#b-0").click(function() { NProgress.start(); });
    $("#b-40").click(function() { NProgress.set(0.4); });
    $("#b-inc").click(function() { NProgress.inc(); });
    $("#b-100").click(function() { NProgress.done(); });
  </script>
	<!--	SCRIPT FOR LOADING BAR   -->
	
		<script>
    var auth = firebase.auth();
    var storageRef = firebase.storage().ref();

    function handleFileSelect(evt) {
      evt.stopPropagation();
      evt.preventDefault();
      var file = evt.target.files[0];

      var metadata = {
        'contentType': file.type
      };

      // Push to child path.
      // [START oncomplete]
      storageRef.child('images/' + file.name).put(file, metadata).then(function(snapshot) {
        console.log('Uploaded', snapshot.totalBytes, 'bytes.');
        console.log(snapshot.metadata);
        
		var url = snapshot.downloadURL;
		var uid = firebase.auth().currentUser.uid;
		  
		 var username_glob;
		  var email_glob;
		  
		    firebase.database().ref('/users/' + uid).once('value').then(function(snapshot) {
  				username_glob = (snapshot.val() && snapshot.val().username) || 'Anonymous';
				console.log('username is ' + username_glob);
				email_glob = (snapshot.val() && snapshot.val().email) || 'Anonymous';
			 	console.log('email is ' + email_glob);
				console.log('profilePic ' + url);
				console.log('uid ' + uid);

				
				firebase.database().ref('users/' + uid/*name*/).set({
    				profilePic: url,
					username: username_glob,
					email: email_glob,
					uid: uid
							
				});		

			    firebase.database().ref('/users/' + uid).once('value').then(function(snapshot) {
					document.getElementById('profilePic').src = (snapshot.val() && snapshot.val().profilePic);
				
				
				});

  			});
		  
		  
		  
		  
		  
        console.log('File available at', url);
        // [START_EXCLUDE]
        // [END_EXCLUDE]
      }).catch(function(error) {
        // [START onfailure]
        console.error('Upload failed:', error);
        // [END onfailure]
      });
      // [END oncomplete]
    }

	function fileUploadedAlert() {
    var x = document.getElementById("alertMessage");
    if (x.style.display === "none") {
        x.style.display = "block";

    } else {
        x.style.display = "none";
    }
}

    window.onload = function() {
		/*var x = document.getElementById("alertMessage");
		x.style.display = "none";*/
		initApp();
      document.getElementById('file').addEventListener('change', handleFileSelect, false);
      document.getElementById('file').disabled = true;

      auth.onAuthStateChanged(function(user) {
        if (user) {
          console.log('Anonymous user signed-in.', user);
          document.getElementById('file').disabled = false;
			
        } else {
          console.log('There was no anonymous session. Creating a new anonymous user.');
          // Sign the user in anonymously since accessing Storage requires the user to be authorized.
          //auth.signInAnonymously();
        }
      });
    }
  </script>

      
</body>

</html>
